<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8201603036199507"
     crossorigin="anonymous"></script>
<title>Terra Quest - Estudos de Geografia</title>

<!-- Security -->
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-Frame-Options" content="DENY">
<meta name="referrer" content="strict-origin-when-cross-origin">

<!-- SEO -->
<meta name="description" content="Terra Quest - Aprenda geografia praticando! 195 países, 27 estados brasileiros, 51 estados americanos e 15 módulos de estudo.">
<meta name="keywords" content="geografia, estudo, aprendizado, países, estados, capitais, bandeiras, mapa, plataforma educacional">
<meta name="author" content="Terra Quest">

<!-- Open Graph -->
<meta property="og:title" content="Terra Quest - Estudos de Geografia">
<meta property="og:description" content="Aprenda e pratique geografia com 15 módulos de estudo!">
<meta property="og:image" content="/globo.png">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Terra Quest - Estudos de Geografia">
<meta name="twitter:description" content="Aprenda e pratique geografia com 15 módulos de estudo!">
<meta name="twitter:image" content="/globo.png">

<!-- Favicon -->
<link rel="icon" type="image/png" href="/globo.png">

<!-- PWA -->
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#e8772e">

<!-- Preconnect to critical CDNs -->
<link rel="preconnect" href="https://d3js.org" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- Preload critical resources -->
<link rel="preload" href="https://d3js.org/d3.v7.min.js" as="script" crossorigin>

<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="light">

<div id="top-right-controls">
<button id="menu-btn">MENU</button>
<button id="end-match-btn" style="display:none">TERMINAR PARTIDA</button>
<button id="theme-toggle" title="Alternar tema"><span id="theme-icon">&#x2600;&#xFE0F;</span><span id="theme-label">Modo Claro</span></button>
<button id="achievements-toggle" style="display:none" title="Minhas Conquistas"><span>&#x1F3C6;</span><span id="achievements-toggle-label">CONQUISTAS</span></button>
</div>

<div id="login-screen"></div>
<div id="register-screen"></div>

<div id="home-screen">
  <canvas id="home-particles"></canvas>
  <img class="home-globe" src="/globo.png" alt="Terra Quest" width="180" height="180">
  <div class="home-title">Terra Quest</div>
  <div class="home-subtitle" id="home-subtitle"></div>
  <button class="play-btn" id="play-btn">COMEÇAR</button>
  <button class="guidelines-btn" id="guidelines-btn">COMO JOGAR</button>
  <button class="achievements-btn" id="achievements-btn" style="display:none"><span class="achievements-btn-icon">&#x1F3C6;</span> MINHAS CONQUISTAS</button>
</div>

<div id="achievements-screen"></div>
<div id="admin-screen"></div>

<div id="stopwatch">00:00</div>
<div id="difficulty-badge"></div>

<div id="select-screen">
  <button class="back-btn" id="back-btn">&larr; Voltar</button>
  <div class="select-title">M&#xF3;dulos de Estudo</div>
  <div class="select-subtitle">Escolha uma categoria para praticar</div>
  <div class="select-section">
    <div class="mode-cards-grid">
      <div class="mode-card category-card" data-category="map-territory">
        <div class="mode-card-icon">&#x1F30D;</div>
        <div class="mode-card-title">Mapa e Territ&#xF3;rio</div>
        <div class="mode-card-desc">Nomear pa&#xED;ses, localizar no mapa e rota entre fronteiras</div>
      </div>
      <div class="mode-card category-card" data-category="flags">
        <div class="mode-card-icon">&#x1F3F3;&#xFE0F;</div>
        <div class="mode-card-title">Bandeiras</div>
        <div class="mode-card-desc">Reconhe&#xE7;a e clique nas bandeiras dos pa&#xED;ses</div>
      </div>
      <div class="mode-card category-card" data-category="capitals">
        <div class="mode-card-icon">&#x1F3DB;&#xFE0F;</div>
        <div class="mode-card-title">Capitais e Cidades</div>
        <div class="mode-card-desc">Capitais, pontos tur&#xED;sticos e localiza&#xE7;&#xE3;o</div>
      </div>
      <div class="mode-card category-card" data-category="languages">
        <div class="mode-card-icon">&#x1F5E3;&#xFE0F;</div>
        <div class="mode-card-title">Idiomas</div>
        <div class="mode-card-desc">Associe pa&#xED;ses aos seus idiomas oficiais</div>
      </div>
      <div class="mode-card category-card" data-category="challenges">
        <div class="mode-card-icon">&#x1F3AF;</div>
        <div class="mode-card-title">Desafios</div>
        <div class="mode-card-desc">Silhuetas, popula&#xE7;&#xE3;o, &#xE1;rea e mais</div>
      </div>
      <div class="mode-card category-card" data-category="study-br">
        <div class="mode-card-silhouette" id="silhouette-card-br"></div>
        <div class="mode-card-title">Estudar o Brasil</div>
        <div class="mode-card-desc">Estados, capitais, biomas, vegeta&#xE7;&#xE3;o e clima</div>
      </div>
      <div class="mode-card category-card" data-category="study-us">
        <div class="mode-card-silhouette" id="silhouette-card-us"></div>
        <div class="mode-card-title">Estudar os EUA</div>
        <div class="mode-card-desc">Estados, capitais e localiza&#xE7;&#xE3;o</div>
      </div>
    </div>
  </div>
</div>

<div id="click-prompt">
  <span>Clique em: </span>
  <span id="click-target-name">---</span>
  <div id="click-score-display">
    <span id="click-correct">&#x2713; 0</span>
    <span id="click-skipped">&#x27F6; 0</span>
    <span id="click-incorrect">&#x2717; 0</span>
    <span id="click-remaining">&#x23F3; 195</span>
  </div>
  <button id="click-skip-btn">Próximo</button>
  <button id="click-give-up-btn">Revelar Respostas</button>
</div>

<div id="flags-banner" class="game-banner">
  <img id="flags-img" src="" alt="Bandeira">
  <div>
    <div class="banner-text" id="flags-progress">1 / 195</div>
  </div>
</div>

<div id="capitals-banner" class="game-banner">
  <div>
    <div class="banner-country" id="capitals-country">---</div>
    <div class="banner-progress" id="capitals-progress">1 / 195</div>
  </div>
  <img id="capitals-flag" class="banner-mini-flag" src="" alt="">
</div>

<div id="lang-banner" class="game-banner">
  <div>
    <div class="banner-text" id="lang-name">---</div>
    <div class="banner-progress" id="lang-progress">L&#xED;ngua 1 / ? &#x2014; Faltam ? pa&#xED;ses</div>
  </div>
</div>

<div id="walk-banner" class="game-banner">
  <div class="walk-route">
    <img id="walk-start-flag" class="banner-mini-flag" src="" alt="">
    <span id="walk-start-name" class="walk-endpoint">---</span>
    <span class="walk-arrow">&#x2192;</span>
    <span id="walk-steps" class="banner-text">0 passos</span>
    <span class="walk-arrow">&#x2192;</span>
    <span id="walk-end-name" class="walk-endpoint">---</span>
    <img id="walk-end-flag" class="banner-mini-flag" src="" alt="">
  </div>
</div>

<div id="world-panel">
<div id="top-bar">
  <div id="score-display">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#e8772e" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20M2 12h20"/></svg>
    <div id="score-text"><span id="score-num">0</span> / <span id="score-total">195</span></div>
  </div>
</div>

<div id="progress-container"><div id="progress-bar"></div></div>
<div id="map-container"></div>
</div>

<div id="states-panel">
<div id="states-map-container"></div>
</div>

<div id="states-score-display">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#e8772e" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 3v18"/></svg>
  <div id="states-score-text"><span id="states-score-num">0</span> / <span id="states-total-num">27</span></div>
</div>

<div id="states-progress-container"><div id="states-progress-bar"></div></div>

<div id="states-input-container">
  <input type="text" id="state-input" placeholder="Digite o nome de um estado..." autocomplete="off" maxlength="100">
  <button id="states-give-up-btn">Revelar Respostas</button>
</div>

<div id="states-hint-display"></div>
<div id="states-feedback"></div>

<div id="states-region-legend"></div>

<div id="input-container">
  <input type="text" id="country-input" placeholder="Digite o nome de um pa&#xED;s..." autocomplete="off" maxlength="100">
  <button id="flags-skip-btn" class="skip-btn" style="display:none">Próximo</button>
  <button id="capitals-skip-btn" class="skip-btn" style="display:none">Próximo</button>
  <button id="lang-skip-btn" class="skip-btn" style="display:none">Próxima Língua</button>
  <button id="give-up-btn">Revelar Respostas</button>
</div>

<div id="hint-display"></div>
<div id="feedback"></div>
<div id="tooltip"></div>

<div id="continent-legend">
  <div class="legend-item" id="leg-AF"><div class="legend-dot" style="background:#f97316"></div>&#xC1;frica<span class="legend-count" id="count-AF">0/0</span></div>
  <div class="legend-item" id="leg-NA"><div class="legend-dot" style="background:#22c55e"></div>Am. Norte<span class="legend-count" id="count-NA">0/0</span></div>
  <div class="legend-item" id="leg-CA"><div class="legend-dot" style="background:#eab308"></div>Am. Central<span class="legend-count" id="count-CA">0/0</span></div>
  <div class="legend-item" id="leg-SA"><div class="legend-dot" style="background:#10b981"></div>Am. Sul<span class="legend-count" id="count-SA">0/0</span></div>
  <div class="legend-item" id="leg-AS"><div class="legend-dot" style="background:#a855f7"></div>&#xC1;sia<span class="legend-count" id="count-AS">0/0</span></div>
  <div class="legend-item" id="leg-EU"><div class="legend-dot" style="background:#3b82f6"></div>Europa<span class="legend-count" id="count-EU">0/0</span></div>
  <div class="legend-item" id="leg-OC"><div class="legend-dot" style="background:#06b6d4"></div>Oceania<span class="legend-count" id="count-OC">0/0</span></div>
</div>

<div id="continent-celebration">
  <div id="celeb-flash"></div>
  <div id="celeb-content">
    <div class="celeb-icon" id="celeb-icon"></div>
    <div class="celeb-title" id="celeb-title"></div>
    <div class="celeb-sub" id="celeb-sub"></div>
  </div>
</div>

<div id="victory-overlay">
  <div id="victory-content">
    <h1>Parab&#xE9;ns!</h1>
    <p>Voc&#xEA; aprendeu todos os 195 pa&#xED;ses!</p>
    <button class="restart-btn" id="restart-btn">Praticar Novamente</button>
    <br><button class="mode-switch-btn" id="mode-switch-btn-v">Trocar Módulo</button>
  </div>
</div>

<div id="gameover-overlay">
  <div id="gameover-content">
    <h1>Sessão Concluída</h1>
    <div class="go-score" id="go-score">0</div>
    <div class="go-label">de 195 pa&#xED;ses estudados</div>
    <div id="gameover-breakdown"></div>
    <button class="restart-btn" id="restart-btn-go">Praticar Novamente</button>
    <br><button class="mode-switch-btn" id="mode-switch-btn-go">Trocar Módulo</button>
  </div>
</div>

<button id="review-btn">Ver Resultado</button>
<div id="review-legend">
  <div class="review-legend-item"><div class="review-legend-swatch" style="border:2.5px solid #fbbf24;background:rgba(251,191,36,0.15);box-shadow:0 0 10px rgba(251,191,36,0.5)"></div>Acertou</div>
  <div class="review-legend-item"><div class="review-legend-swatch" style="border:2px solid #94a3b8;background:rgba(148,163,184,0.15)"></div>Para estudar</div>
</div>

<div id="silhouette-panel">
  <div class="streak-container" id="streak-container-silhouettes" style="display:none">
    <span class="streak-label">Sequ&#xEA;ncia:</span>
    <span class="streak-value" id="streak-value-silhouettes">0</span>
    <span class="streak-best" id="streak-best-silhouettes">Melhor: 0</span>
  </div>
  <div id="silhouette-svg-container"></div>
  <div id="silhouette-options"></div>
</div>

<div id="population-panel">
  <div class="streak-container" id="streak-container-population" style="display:none">
    <span class="streak-label">Sequ&#xEA;ncia:</span>
    <span class="streak-value" id="streak-value-population">0</span>
    <span class="streak-best" id="streak-best-population">Melhor: 0</span>
  </div>
  <div class="pop-question">Qual tem mais popula&#xE7;&#xE3;o?</div>
  <div class="pop-cards" id="population-cards"></div>
</div>

<div id="game-mode-panel">
  <div class="streak-container" id="streak-container-game" style="display:none">
    <span class="streak-label">Sequ&#xEA;ncia:</span>
    <span class="streak-value" id="streak-value-game">0</span>
    <span class="streak-best" id="streak-best-game">Melhor: 0</span>
  </div>
  <div id="game-mode-display"></div>
  <div id="game-mode-options"></div>
</div>

<div id="where-banner">
  <span>Clique em: </span>
  <span id="where-target-name">---</span>
  <span id="where-round-info">Rodada 1 / 7</span>
  <span id="where-points-display">Pontos: 0</span>
</div>

<div id="where-round-result"></div>

<div id="flag-click-panel">
  <div id="flag-click-header">
    <span id="flag-click-progress">0 / 30  0%</span>
    <span>Clique em <strong id="flag-click-target">---</strong></span>
    <button id="flag-click-skip" class="skip-btn">&#x25B6;|</button>
  </div>
  <div id="flag-click-grid"></div>
</div>

<div id="capital-locate-panel">
  <div id="capital-locate-banner" class="game-banner" style="display:flex">
    <span id="capital-locate-progress">0 / 10</span>
    <span>Clique em <strong id="capital-locate-target">---</strong></span>
    <img id="capital-locate-flag" class="banner-mini-flag" src="" alt="" style="display:none">
  </div>
  <div id="capital-locate-map"></div>
</div>

<div id="biomes-panel">
  <div id="biomes-banner" class="game-banner" style="display:flex">
    <span id="biomes-progress">0 / 6</span>
    <span>Clique em <strong id="biomes-target">---</strong></span>
  </div>
  <div id="biomes-map"></div>
</div>

<script>
// DEV MOCK — intercepta fetch para testar sem backend
(function(){
  if (location.hostname !== 'localhost') return;
  const _fetch = window.fetch;
  const MOCK = {
    '/api/auth/me': { user: { id: 1, name: 'Dev Tester', email: 'dev@test.com' }, isAdmin: false },
    '/api/auth/config': { googleClientId: '' },
    '/api/records': { records: {} },
    '/api/records/stats': {
      totalXP: 4820,
      modeStats: [
        { game_mode:'world-type', games_played:25, best_score:142, best_total:195, best_time:540, total_time:9800, mode_xp:1200 },
        { game_mode:'world-click', games_played:18, best_score:120, best_total:195, best_time:620, total_time:7200, mode_xp:800 },
        { game_mode:'world-flags', games_played:12, best_score:180, best_total:195, best_time:480, total_time:5400, mode_xp:960 },
        { game_mode:'world-capitals', games_played:8, best_score:95, best_total:195, best_time:700, total_time:4000, mode_xp:500 },
        { game_mode:'world-silhouettes', games_played:15, best_score:32, best_total:32, best_time:300, total_time:3600, mode_xp:480 },
        { game_mode:'world-population', games_played:10, best_score:22, best_total:22, best_time:250, total_time:2000, mode_xp:350 },
        { game_mode:'br-states', games_played:6, best_score:27, best_total:27, best_time:180, total_time:1200, mode_xp:280 },
        { game_mode:'us-states', games_played:3, best_score:40, best_total:51, best_time:420, total_time:900, mode_xp:250 }
      ],
      overall: { total_games: 97, total_time: 34100, modes_played: 8 },
      playDates: (function(){
        var d=[]; var t=new Date(); for(var i=0;i<7;i++){
          d.push(new Date(t.getTime()-i*86400000).toISOString().slice(0,10));
        } return d;
      })(),
      difficultyStats: [
        { difficulty:'learning', games_played:20, best_score:142, total_xp:800 },
        { difficulty:'easy', games_played:45, best_score:180, total_xp:2400 },
        { difficulty:'hard', games_played:32, best_score:120, total_xp:1620 }
      ]
    },
    '/api/records/rankings': {
      rankings: [
        { name:'Maria S.', best_score:195, total:195, best_time:420, xp_earned:400 },
        { name:'João S.', best_score:190, total:195, best_time:480, xp_earned:380 },
        { name:'Dev T.', best_score:180, total:195, best_time:540, xp_earned:360 },
        { name:'Ana C.', best_score:175, total:195, best_time:560, xp_earned:340 },
        { name:'Pedro L.', best_score:168, total:195, best_time:600, xp_earned:320 },
        { name:'Lucas O.', best_score:155, total:195, best_time:620, xp_earned:300 },
        { name:'Carla S.', best_score:142, total:195, best_time:700, xp_earned:280 },
        { name:'Felipe R.', best_score:130, total:195, best_time:750, xp_earned:260 },
        { name:'Bruna A.', best_score:118, total:195, best_time:800, xp_earned:240 },
        { name:'Rafael D.', best_score:100, total:195, best_time:850, xp_earned:200 }
      ]
    },
    '/api/analytics/pageview': { ok: true }
  };
  window.fetch = function(url, opts) {
    var path = typeof url === 'string' ? url.split('?')[0] : '';
    if (MOCK[path]) {
      return Promise.resolve({ ok:true, status:200, json:function(){ return Promise.resolve(JSON.parse(JSON.stringify(MOCK[path]))); } });
    }
    if (path === '/api/records' && opts && opts.method === 'POST') {
      return Promise.resolve({ ok:true, status:201, json:function(){ return Promise.resolve({ ok:true, xp_earned:42 }); } });
    }
    return _fetch.apply(this, arguments);
  };
  console.log('%c[MOCK] API mock ativo — dados de teste carregados', 'color:#22c55e;font-weight:bold');
})();
</script>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://d3js.org/d3.v7.min.js" integrity="sha384-CjloA8y00+1SDAUkjs099PVfnY2KmDC2BZnws9kh8D/lX1s46w6EPhpXdqMfjK6i" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/topojson-client@3" integrity="sha384-Ukv1p/xTma6P4/2bY5KzWBw+ydSpXmhCMtyciIQVDJ1RmOxtCYNMF1uXT9T63H67" crossorigin="anonymous"></script>
<script type="module" src="/js/app.js"></script>
</body>
</html>
